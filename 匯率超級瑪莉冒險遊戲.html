<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>匯率超級瑪莉冒險遊戲</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .game-container {
            width: 100%;
            max-width: 1000px;
            padding: 20px;
        }
        
        .game-title {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .game-title h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .game-screen {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        
        .market-data {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .market-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .market-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .game-canvas {
            width: 100%;
            height: 400px;
            background: linear-gradient(to bottom, #87CEEB 0%, #98FB98 100%);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            border: 3px solid #4CAF50;
            margin: 20px 0;
        }
        
        .player {
            position: absolute;
            width: 40px;
            height: 40px;
            font-size: 30px;
            transition: left 0.1s ease;
            z-index: 10;
        }
        
        .platform {
            position: absolute;
            background: #8B4513;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .news-item {
            position: absolute;
            padding: 8px;
            border-radius: 8px;
            font-size: 11px;
            max-width: 120px;
            text-align: center;
            border: 2px solid;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .news-item:hover {
            transform: scale(1.1);
        }
        
        .news-bullish {
            background: #c8e6c9;
            border-color: #4caf50;
            color: #2e7d32;
        }
        
        .news-bearish {
            background: #ffcdd2;
            border-color: #f44336;
            color: #c62828;
        }
        
        .news-mixed {
            background: #fff3e0;
            border-color: #ff9800;
            color: #e65100;
        }
        
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .stat-item {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #2196F3, #1976D2);
        }
        
        .advice-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .advice-item {
            background: white;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 4px solid #2196f3;
            font-size: 12px;
        }
        
        .controls {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px;
            border-radius: 8px;
            font-size: 11px;
        }
        
        .hidden { display: none; }
        
        @media (max-width: 768px) {
            .game-title h1 { font-size: 2rem; }
            .stats-bar { grid-template-columns: repeat(3, 1fr); }
            .market-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-title">
            <h1>🍄 匯率超級瑪莉冒險 🍄</h1>
            <p>接住財金新聞，學習投資時機！</p>
        </div>
        
        <div class="game-screen">
            <!-- 主選單 -->
            <div id="menu-screen">
                <div style="text-align: center;">
                    <div style="font-size: 4rem; margin-bottom: 20px;">🎮</div>
                    <h2 style="margin-bottom: 20px;">準備開始冒險！</h2>
                    
                    <div class="market-data">
                        <h3 style="color: #1976d2; margin-bottom: 15px;">📈 今日市場數據</h3>
                        <div class="market-grid">
                            <div class="market-item">
                                <div style="font-weight: bold; color: #4caf50;">AUD/USD</div>
                                <div style="font-size: 1.2rem; color: #4caf50;">0.6470</div>
                            </div>
                            <div class="market-item">
                                <div style="font-weight: bold;">24H變化</div>
                                <div style="font-size: 1.2rem; color: #4caf50;">+0.65%</div>
                            </div>
                            <div class="market-item">
                                <div style="font-weight: bold;">阻力位</div>
                                <div style="font-size: 1.2rem;">0.6625</div>
                            </div>
                            <div class="market-item">
                                <div style="font-weight: bold;">支撐位</div>
                                <div style="font-size: 1.2rem;">0.6400</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0;">
                        <div style="background: #c8e6c9; padding: 20px; border-radius: 10px;">
                            <h3 style="color: #2e7d32; margin-bottom: 15px;">🎯 遊戲目標</h3>
                            <ul style="text-align: left; color: #2e7d32; font-size: 14px;">
                                <li>接住有利新聞增加分數</li>
                                <li>避開負面新聞保護生命</li>
                                <li>收集投資建議和策略</li>
                                <li>收集蘑菇獲得額外獎勵</li>
                            </ul>
                        </div>
                        
                        <div style="background: #e3f2fd; padding: 20px; border-radius: 10px;">
                            <h3 style="color: #1976d2; margin-bottom: 15px;">🎮 操作方式</h3>
                            <ul style="text-align: left; color: #1976d2; font-size: 14px;">
                                <li>← → 或 A/D 鍵移動</li>
                                <li>↑ 或 空白鍵跳躍</li>
                                <li>點擊新聞也可收集</li>
                                <li>綠色：利多 紅色：利空</li>
                            </ul>
                        </div>
                    </div>
                    
                    <button class="btn" onclick="startGame()">🚀 開始遊戲</button>
                </div>
            </div>
            
            <!-- 遊戲畫面 -->
            <div id="game-screen" class="hidden">
                <div class="stats-bar">
                    <div class="stat-item">
                        <div class="stat-value" style="color: #2196f3;" id="score">0</div>
                        <div>分數</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" style="color: #f44336;" id="lives">3</div>
                        <div>生命</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" style="color: #ff9800;" id="coins">0</div>
                        <div>蘑菇</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" style="color: #9c27b0;" id="time">60</div>
                        <div>時間</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" style="color: #4caf50;" id="level">1</div>
                        <div>關卡</div>
                    </div>
                </div>
                
                <div class="game-canvas" id="gameCanvas">
                    <!-- 平台 -->
                    <div class="platform" style="left: 0px; top: 370px; width: 200px; height: 20px;"></div>
                    <div class="platform" style="left: 250px; top: 300px; width: 150px; height: 20px;"></div>
                    <div class="platform" style="left: 450px; top: 220px; width: 120px; height: 20px;"></div>
                    <div class="platform" style="left: 600px; top: 350px; width: 100px; height: 20px;"></div>
                    <div class="platform" style="left: 750px; top: 280px; width: 120px; height: 20px;"></div>
                    
                    <!-- 玩家 -->
                    <div class="player" id="player" style="left: 50px; top: 330px;">🍄</div>
                    
                    <!-- 控制說明 -->
                    <div class="controls">
                        ← → 移動 | 空白鍵跳躍 | 點擊新聞收集
                    </div>
                </div>
                
                <div class="advice-panel hidden" id="advicePanel">
                    <h3 style="margin-bottom: 15px;">💡 即時投資建議</h3>
                    <div id="adviceList"></div>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="pauseGame()">⏸️ 暫停</button>
                    <button class="btn" style="background: linear-gradient(45deg, #f44336, #d32f2f);" onclick="endGame()">🛑 結束遊戲</button>
                </div>
            </div>
            
            <!-- 遊戲結束畫面 -->
            <div id="gameover-screen" class="hidden" style="text-align: center;">
                <div style="font-size: 4rem; margin-bottom: 20px;">🏆</div>
                <h2 style="margin-bottom: 20px;">遊戲結束！</h2>
                
                <div class="stats-bar">
                    <div class="stat-item">
                        <div class="stat-value" style="color: #2196f3;" id="finalScore">0</div>
                        <div>最終分數</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" style="color: #ff9800;" id="finalCoins">0</div>
                        <div>收集蘑菇</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" style="color: #4caf50;" id="finalAdvice">0</div>
                        <div>投資建議</div>
                    </div>
                </div>
                
                <div style="background: linear-gradient(45deg, #e3f2fd, #c8e6c9); padding: 30px; border-radius: 15px; margin: 20px 0;">
                    <h3 style="margin-bottom: 20px;">📊 投資策略總結</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div>
                            <h4 style="color: #4caf50; margin-bottom: 10px;">✅ 進場信號</h4>
                            <ul style="text-align: left; font-size: 13px; line-height: 1.5;">
                                <li>突破0.6500阻力位</li>
                                <li>澳洲央行鷹派政策</li>
                                <li>中國經濟數據改善</li>
                                <li>鐵礦石價格回升</li>
                            </ul>
                        </div>
                        <div>
                            <h4 style="color: #f44336; margin-bottom: 10px;">❌ 退場信號</h4>
                            <ul style="text-align: left; font-size: 13px; line-height: 1.5;">
                                <li>跌破0.6400支撐位</li>
                                <li>美聯儲重啟升息</li>
                                <li>貿易戰惡化</li>
                                <li>澳洲數據轉弱</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div>
                    <button class="btn" onclick="startGame()">🔄 再玩一次</button>
                    <button class="btn btn-secondary" onclick="showMenu()">🏠 主選單</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 遊戲狀態
        let gameState = {
            playing: false,
            score: 0,
            lives: 3,
            coins: 0,
            time: 60,
            level: 1,
            player: { x: 50, y: 330, velocity: 0, onGround: true },
            fallingNews: [],
            advice: []
        };

        // 新聞數據
        const newsItems = [
            { text: "AUD/USD漲至0.6470", type: "bullish", points: 20, advice: "技術面突破，考慮進場做多" },
            { text: "澳洲央行鷹派立場", type: "bullish", points: 25, advice: "升息預期推升澳元，持續看多" },
            { text: "美聯儲暫停升息", type: "bullish", points: 30, advice: "美元疲軟，AUD相對受益" },
            { text: "中國經濟數據疲軟", type: "bearish", points: -15, advice: "澳洲出口受影響，謹慎操作" },
            { text: "鐵礦石價格下跌", type: "bearish", points: -20, advice: "澳元承壓，考慮獲利了結" },
            { text: "通膨數據超預期", type: "mixed", points: 10, advice: "短期波動加劇，設置停損" },
            { text: "就業數據強勁", type: "bullish", points: 25, advice: "經濟基本面改善，持續持有" },
            { text: "貿易戰升溫", type: "bearish", points: -25, advice: "避險情緒升溫，減少風險部位" }
        ];

        // 平台數據
        const platforms = [
            { x: 0, y: 370, width: 200, height: 20 },
            { x: 250, y: 300, width: 150, height: 20 },
            { x: 450, y: 220, width: 120, height: 20 },
            { x: 600, y: 350, width: 100, height: 20 },
            { x: 750, y: 280, width: 120, height: 20 }
        ];

        let gameLoop;
        let timeInterval;
        let newsInterval;

        // 開始遊戲
        function startGame() {
            gameState = {
                playing: true,
                score: 0,
                lives: 3,
                coins: 0,
                time: 60,
                level: 1,
                player: { x: 50, y: 330, velocity: 0, onGround: true },
                fallingNews: [],
                advice: []
            };

            showScreen('game');
            updateStats();
            
            // 清除之前的新聞
            document.querySelectorAll('.news-item').forEach(el => el.remove());
            
            // 開始遊戲循環
            gameLoop = setInterval(updateGame, 50);
            
            // 生成新聞
            newsInterval = setInterval(generateNews, 3000);
            
            // 計時器
            timeInterval = setInterval(() => {
                gameState.time -= 0.1;
                updateStats();
                
                if (gameState.time <= 0 || gameState.lives <= 0) {
                    endGame();
                }
            }, 100);
        }

        // 更新遊戲
        function updateGame() {
            if (!gameState.playing) return;
            
            updatePlayer();
            updateFallingNews();
            checkCollisions();
        }

        // 更新玩家
        function updatePlayer() {
            const player = gameState.player;
            
            // 應用重力
            if (!player.onGround) {
                player.velocity += 0.8;
            }
            
            player.y += player.velocity;
            player.onGround = false;

            // 檢查平台碰撞
            platforms.forEach(platform => {
                if (player.x + 30 > platform.x && 
                    player.x < platform.x + platform.width &&
                    player.y + 30 >= platform.y && 
                    player.y + 30 <= platform.y + 20 &&
                    player.velocity >= 0) {
                    player.y = platform.y - 30;
                    player.velocity = 0;
                    player.onGround = true;
                }
            });

            // 地面邊界
            if (player.y > 350) {
                player.y = 350;
                player.velocity = 0;
                player.onGround = true;
            }

            // 側邊邊界
            if (player.x < 0) player.x = 0;
            if (player.x > 860) player.x = 860;

            // 更新DOM位置
            const playerElement = document.getElementById('player');
            playerElement.style.left = player.x + 'px';
            playerElement.style.top = player.y + 'px';
        }

        // 生成新聞
        function generateNews() {
            if (!gameState.playing) return;
            
            const newsItem = newsItems[Math.floor(Math.random() * newsItems.length)];
            const news = {
                ...newsItem,
                id: Date.now(),
                x: Math.random() * 700,
                y: -50
            };
            
            gameState.fallingNews.push(news);
            
            // 創建新聞元素
            const newsElement = document.createElement('div');
            newsElement.id = 'news-' + news.id;
            newsElement.className = 'news-item news-' + news.type;
            newsElement.style.left = news.x + 'px';
            newsElement.style.top = news.y + 'px';
            newsElement.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 2px;">
                    ${news.type === 'bullish' ? '📈' : news.type === 'bearish' ? '📉' : '📊'}
                </div>
                <div style="font-weight: bold; font-size: 9px;">${news.text}</div>
                <div style="font-weight: bold; margin-top: 2px;">
                    ${news.points > 0 ? '+' : ''}${news.points}
                </div>
            `;
            
            newsElement.onclick = () => collectNews(news.id);
            document.getElementById('gameCanvas').appendChild(newsElement);
        }

        // 更新掉落新聞
        function updateFallingNews() {
            gameState.fallingNews = gameState.fallingNews.filter(news => {
                news.y += 2;
                
                const newsElement = document.getElementById('news-' + news.id);
                if (newsElement) {
                    newsElement.style.top = news.y + 'px';
                }
                
                // 移除掉出畫面的新聞
                if (news.y > 420) {
                    if (newsElement) newsElement.remove();
                    return false;
                }
                return true;
            });
        }

        // 顯示蘑菇獎勵效果
        function showMushroom(x, y) {
            const mushroom = document.createElement('div');
            mushroom.innerHTML = '🍄';
            mushroom.style.position = 'absolute';
            mushroom.style.left = x + 'px';
            mushroom.style.top = y + 'px';
            mushroom.style.fontSize = '20px';
            mushroom.style.zIndex = '15';
            mushroom.style.animation = 'mushroomFloat 1s ease-out forwards';
            
            // 添加CSS動畫
            if (!document.querySelector('#mushroomStyle')) {
                const style = document.createElement('style');
                style.id = 'mushroomStyle';
                style.textContent = `
                    @keyframes mushroomFloat {
                        0% { transform: translateY(0) scale(1); opacity: 1; }
                        50% { transform: translateY(-30px) scale(1.3); opacity: 0.8; }
                        100% { transform: translateY(-60px) scale(0.5); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
            
            document.getElementById('gameCanvas').appendChild(mushroom);
            
            setTimeout(() => {
                if (mushroom.parentNode) {
                    mushroom.remove();
                }
            }, 1000);
        }

        // 檢查碰撞
        function checkCollisions() {
            const player = gameState.player;
            
            gameState.fallingNews.forEach(news => {
                if (Math.abs(player.x + 15 - (news.x + 60)) < 50 && 
                    Math.abs(player.y + 15 - (news.y + 15)) < 35) {
                    collectNews(news.id);
                }
            });
        }

        // 收集新聞
        function collectNews(newsId) {
            const news = gameState.fallingNews.find(n => n.id === newsId);
            if (!news) return;
            
            // 移除新聞元素
            const newsElement = document.getElementById('news-' + newsId);
            if (newsElement) {
                newsElement.style.transform = 'scale(1.5)';
                newsElement.style.opacity = '0';
                setTimeout(() => newsElement.remove(), 200);
            }
            
            // 移除從數組
            gameState.fallingNews = gameState.fallingNews.filter(n => n.id !== newsId);
            
            // 更新分數
            if (news.points > 0) {
                gameState.score += news.points;
                gameState.coins += 1;
                
                // 生成蘑菇獎勵效果
                showMushroom(news.x, news.y);
            } else {
                gameState.lives = Math.max(0, gameState.lives - 1);
            }
            
            // 添加建議
            gameState.advice.push({
                text: news.advice,
                type: news.type,
                time: new Date().toLocaleTimeString()
            });
            
            updateStats();
            updateAdvice();
        }

        // 更新統計
        function updateStats() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('lives').textContent = gameState.lives;
            document.getElementById('coins').textContent = gameState.coins;
            document.getElementById('time').textContent = Math.ceil(gameState.time);
            document.getElementById('level').textContent = gameState.level;
        }

        // 更新建議
        function updateAdvice() {
            const panel = document.getElementById('advicePanel');
            const list = document.getElementById('adviceList');
            
            if (gameState.advice.length > 0) {
                panel.classList.remove('hidden');
                
                list.innerHTML = gameState.advice.slice(-3).reverse().map(advice => `
                    <div class="advice-item">
                        <div style="font-weight: bold; margin-bottom: 3px;">${advice.text}</div>
                        <div style="font-size: 10px; color: #666;">${advice.time}</div>
                    </div>
                `).join('');
            }
        }

        // 結束遊戲
        function endGame() {
            gameState.playing = false;
            clearInterval(gameLoop);
            clearInterval(timeInterval);
            clearInterval(newsInterval);
            
            document.getElementById('finalScore').textContent = gameState.score;
            document.getElementById('finalCoins').textContent = gameState.coins;
            document.getElementById('finalAdvice').textContent = gameState.advice.length;
            
            showScreen('gameover');
        }

        // 暫停遊戲
        function pauseGame() {
            if (gameState.playing) {
                gameState.playing = false;
                clearInterval(gameLoop);
                clearInterval(timeInterval);
                clearInterval(newsInterval);
            } else {
                gameState.playing = true;
                gameLoop = setInterval(updateGame, 50);
                timeInterval = setInterval(() => {
                    gameState.time -= 0.1;
                    updateStats();
                    if (gameState.time <= 0 || gameState.lives <= 0) {
                        endGame();
                    }
                }, 100);
                newsInterval = setInterval(generateNews, 3000);
            }
        }

        // 顯示畫面
        function showScreen(screen) {
            document.getElementById('menu-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('gameover-screen').classList.add('hidden');
            
            if (screen === 'menu') {
                document.getElementById('menu-screen').classList.remove('hidden');
            } else if (screen === 'game') {
                document.getElementById('game-screen').classList.remove('hidden');
            } else if (screen === 'gameover') {
                document.getElementById('gameover-screen').classList.remove('hidden');
            }
        }

        // 返回主選單
        function showMenu() {
            gameState.playing = false;
            clearInterval(gameLoop);
            clearInterval(timeInterval);
            clearInterval(newsInterval);
            
            // 清除所有新聞
            document.querySelectorAll('.news-item').forEach(el => el.remove());
            
            showScreen('menu');
        }

        // 鍵盤控制
        document.addEventListener('keydown', (e) => {
            if (!gameState.playing) return;
            
            const player = gameState.player;
            
            switch(e.key) {
                case 'ArrowLeft':
                case 'a':
                case 'A':
                    player.x = Math.max(0, player.x - 15);
                    break;
                case 'ArrowRight':
                case 'd':
                case 'D':
                    player.x = Math.min(860, player.x + 15);
                    break;
                case ' ':
                case 'ArrowUp':
                case 'w':
                case 'W':
                    e.preventDefault();
                    if (player.onGround) {
                        player.velocity = -15;
                        player.onGround = false;
                    }
                    break;
            }
        });

        // 防止空白鍵滾動頁面
        document.addEventListener('keydown', (e) => {
            if (e.key === ' ') {
                e.preventDefault();
            }
        });

        // 初始化
        window.onload = () => {
            showScreen('menu');
        };
    </script>
</body>
</html>
